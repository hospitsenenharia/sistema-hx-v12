<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Sistema HX â€” GestÃ£o Administrativa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- LIBS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <style>
    :root {
      --hx-dark:#0d0d0d; --hx-dark2:#151515;
      --hx-accent:#0aff9d; --hx-text:#eaeaea; --hx-danger:#ff5566;
    }
    body {
      margin:0; background:var(--hx-dark); color:var(--hx-text);
      font-family:Segoe UI,sans-serif; display:flex;
    }
    #loginOverlay {
      position:fixed; inset:0; background:#000; z-index:9999;
      display:flex; align-items:center; justify-content:center;
    }
    .login-card {
      background:#181818; padding:30px; border-radius:12px;
      border:1px solid var(--hx-accent); width:320px;
    }
    input, select, textarea {
      width:100%; padding:10px; margin:8px 0;
      background:#222; border:1px solid #444; color:#fff;
    }
    .btn { padding:10px; border:none; cursor:pointer; font-weight:bold; }
    .btn-add { background:var(--hx-accent); color:#000; }
    .btn-del { background:var(--hx-danger); color:#fff; }
    #sidebar {
      width:240px; background:var(--hx-dark2);
      height:100vh; position:fixed; border-right:1px solid #333;
    }
    main { margin-left:240px; padding:25px; flex:1; }
    .card { background:#181818; padding:20px; border-radius:8px; margin-bottom:20px; }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="loginOverlay">
  <div class="login-card">
    <h2 style="text-align:center;color:var(--hx-accent)">SISTEMA HX</h2>
    <input id="lEmail" type="email" placeholder="admin@hx.com">
    <input id="lPass" type="password" placeholder="Senha">
    <button class="btn btn-add" style="width:100%" onclick="login()">ENTRAR</button>
    <p id="lErr" style="color:var(--hx-danger);text-align:center"></p>
  </div>
</div>

<nav id="sidebar"></nav>

<main>
  <h2 style="color:var(--hx-accent)">ðŸ“Š Dashboard</h2>
  <div class="card">
    <canvas id="chartDiario"></canvas>
  </div>
</main>

<!-- =================== SCRIPT ÃšNICO =================== -->
<script>
/* ===== SUPABASE ===== */
const { createClient } = supabase;
const db = createClient(
  "https://axfccmezfofnqfsdurqb.supabase.co",
  "SUA_CHAVE_ANON_AQUI"
);

/* ===== VARIÃVEIS ===== */
let _vens = [];
let chartInstance = null;

/* ===== LOGIN ===== */
async function login() {
  const email = document.getElementById("lEmail").value;
  const senha = document.getElementById("lPass").value;
  const msg = document.getElementById("lErr");

  if (!email || !senha) {
    msg.innerText = "Preencha email e senha";
    return;
  }

  const { error } = await db.auth.signInWithPassword({
    email, password: senha
  });

  if (error) {
    msg.innerText = error.message;
    return;
  }

  document.getElementById("loginOverlay").style.display = "none";
  loadAll();
}

/* ===== LOAD ===== */
async function loadAll() {
  const { data } = await db.from("vendas").select("*").order("data",{ascending:false});
  _vens = data || [];
  renderChart();
}

/* ===== CHART ===== */
function renderChart() {
  const ctx = document.getElementById("chartDiario");
  if (chartInstance) chartInstance.destroy();

  chartInstance = new Chart(ctx, {
    type: "line",
    data: {
      labels: _vens.map(v => v.data?.split("T")[0]),
      datasets: [{
        label: "Vendas",
        data: _vens.map(v => v.valor || 0),
        borderColor: "#0aff9d",
        backgroundColor: "rgba(10,255,157,0.2)",
        fill: true
      }]
    }
  });
}

/* ===== AUTO LOGIN ===== */
window.onload = async () => {
  const { data } = await db.auth.getSession();
  if (data.session) {
    document.getElementById("loginOverlay").style.display = "none";
    loadAll();
  }
};
</script>

</body>
</html>
